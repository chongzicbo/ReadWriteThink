# 1. PCM基本概念

PCM全称Pulse-Code Modulation，翻译一下是脉冲调制编码。在音视频中，PCM是一种用数字表示[采样](https://so.csdn.net/so/search?q=采样&spm=1001.2101.3001.7020)模拟信号的方法。要将一段[音频](https://so.csdn.net/so/search?q=音频&spm=1001.2101.3001.7020)模拟信号转换为数字表示，包含如下三个步骤：

- 1、Sampling(采样)

- 2、Quantization(量化)

- 3、Coding(编码)
  通常，我们可以通过一条曲线在坐标中显示连续的模拟信号，如下图所示：

  ![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/7f641ea2f7e6c7d5fd8edb272e4e310e.png)

  取其中一段如下：

![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/bad65712ebb7538e9b7ddacf2c03ca2b.png)

![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/c2f72cd5a551c0bb974c4756b9dc7234.png)

#### PCM常用指标

- **采样率(Sample rate)**：每秒钟采样多少次，以Hz为单位。
- **位深度(Bit-depth)**：表示用多少个二进制位来描述采样数据，一般为16bit。
- **字节序**：表示音频PCM数据存储的字节序是大端存储（big-endian）还是小端存储（little-endian），为了数据处理效率的高效，通常为小端存储。
- **声道数（channel number）**：当前PCM文件中包含的声道数，是单声道（mono）、双声道（stereo），此外还有5.1声道（常用于影院立体环绕声）等。
- **采样数据是否有符号（Sign）**：要表达的就是字面上的意思，需要注意的是，使用有符号的采样数据不能用无符号的方式播放。



# 2. 音频采样

![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/05d2b638f098e044e31b1a6ce0cb4624.png)

### 2.1 含义

音频采样（Sampling）是数字音频处理中的一个关键步骤，它将连续的模拟音频信号转换为离散的数字信号。采样是指在时间轴上对模拟音频信号进行离散化处理。具体来说，就是在固定的时间间隔内，测量模拟信号的幅度值。这些测量值被称为“采样点”或“样本”。

### 2.2 采样过程

#### 2.2.1 选择采样率

- **采样率（Sampling Rate）**：采样率是指每秒钟对模拟信号进行采样的次数，通常以赫兹（Hz）为单位。常见的采样率有44.1 kHz（CD音质）、48 kHz（DVD音质）、96 kHz（高解析度音频）等。
- **奈奎斯特定理（Nyquist Theorem）**：为了准确地重构原始模拟信号，采样率必须至少是信号最高频率的两倍。例如，如果音频信号的最高频率为20 kHz，那么采样率至少需要40 kHz。

#### 2.2.2 采样点的获取

- **时间间隔**：在每个固定的时间间隔内，测量模拟信号的幅度值。这个时间间隔由采样率决定，例如，44.1 kHz的采样率意味着每秒钟测量44100次。
- **幅度值**：在每个采样点上，记录模拟信号的瞬时幅度值。这些幅度值可以是正的或负的，表示信号的波峰和波谷。

### 2.3 采样示例

假设我们有一个简单的正弦波模拟音频信号，其频率为1 kHz。如果我们选择44.1 kHz的采样率，那么每秒钟将会有44100个采样点。每个采样点记录的是该时刻信号的幅度值。

### 2.4 采样后的信号

采样后的信号是一个离散的数字信号，由一系列的采样点组成。每个采样点代表一个时间点上的信号幅度值。这些采样点按时间顺序排列，形成一个数字音频流。

### 2.5 采样误差

- **混叠（Aliasing）**：如果采样率低于奈奎斯特频率（即信号最高频率的两倍），则会产生混叠现象。混叠会导致高频信号被错误地表现为低频信号，从而产生失真。
- **量化误差（Quantization Error）**：采样后的信号还需要进行量化处理，将连续的幅度值转换为离散的数字值。量化过程会产生量化误差，即原始信号与量化后的信号之间的差异。

### 2.6 采样的应用

- **音频录制**：在音频录制过程中，麦克风捕捉到的模拟信号首先需要进行采样，转换为数字信号，然后才能进行存储或进一步处理。
- **音频处理**：在数字音频工作站（DAW）中，音频信号通常以数字形式进行处理，采样是这一过程中的第一步。
- **音频传输**：在数字音频接口（如S/PDIF、AES/EBU）中，音频信号以数字形式传输，采样是确保信号准确传输的关键步骤。

# 3. 量化

![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/ce9bf096bd98f9534476a3e998f0de38.png)

![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/f85f183853b11948dee89f4b6a1977ec.png)

### 3.1 含义

量化是指将采样得到的幅度值转换为离散的数字值。具体来说，就是将连续的幅度值映射到有限的离散级别上。

### 3.2 量化位数（Bit Depth）

- **定义**：量化位数是指每个采样点用多少位二进制数来表示。常见的量化位数有16位（CD音质）、24位（高解析度音频）等。
- **范围**：量化位数决定了可以表示的幅度值的数量。例如，16位量化可以表示2^16 = 65536个不同的幅度值，24位量化可以表示2^24 = 16777216个不同的幅度值。

### 3.3 量化过程

- **量化级别**：量化过程将连续的幅度值划分为若干个离散的级别。每个级别对应一个特定的数字值。
- **映射**：每个采样点的幅度值被映射到最近的量化级别上。例如，如果量化位数为16位，那么每个采样点的幅度值将被映射到65536个可能的级别之一。

### 3.4 量化示例

假设我们有一个模拟音频信号，其幅度范围为-1到+1。如果我们使用16位量化，那么可以将这个范围划分为65536个离散的级别。

- **最小量化级别**：-1到+1之间的最小量化级别为2/65536 = 0.000030518。
- **映射**：每个采样点的幅度值将被映射到最近的量化级别上。例如，如果某个采样点的幅度值为0.5001，那么它将被映射到最近的量化级别，例如0.5000。

### 3.5 量化误差（Quantization Error）

由于量化过程将连续的幅度值映射到有限的离散级别上，因此会产生量化误差，即原始信号与量化后的信号之间的差异。量化误差会导致音频信号的失真，称为量化噪声。

### 3.6 量化位数的影响

- **量化位数越高**：可以表示的幅度值越多，量化误差越小，音质越好，但数据量也越大。
- **量化位数越低**：可以表示的幅度值越少，量化误差越大，音质越差，但数据量也越小。

# 4.编码

![在这里插入图片描述](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/a673723a54a80a37735e1117e5e1b681.png)

### 4.1 含义

量化之后的编码是指将量化后的离散幅度值转换为二进制数字信号的过程。

### 4.2 量化后的幅度值

在量化过程中，连续的模拟幅度值被映射到有限的离散级别上。每个采样点的幅度值被转换为一个离散的数字值。例如，如果使用16位量化，每个采样点的幅度值将被映射到65536个可能的级别之一。

### 4.2 编码过程

编码过程将这些离散的量化值转换为二进制数字信号。具体来说，每个量化值被表示为一个二进制数，这些二进制数按时间顺序排列，形成一个数字音频流。

#### 4.2.1 二进制表示

- **二进制数**：每个量化值被表示为一个二进制数。例如，16位量化意味着每个量化值用16位二进制数表示。
- **符号位**：在有符号量化中，最高位（MSB）通常用于表示符号（正或负），其余位表示幅度值。例如，16位有符号量化中，最高位表示符号，其余15位表示幅度值。

#### 4.2.2 编码示例

假设我们有一个16位有符号量化，其幅度范围为-32768到+32767。以下是一个简单的编码示例：

- **量化值**：假设某个采样点的量化值为+1000。
- **二进制表示**：+1000的二进制表示为 `0000001111101000`（16位）。
  - 最高位（MSB）为0，表示正数。
  - 其余15位表示幅度值1000。

### 4.3 PCM格式

编码后的数字音频流通常以PCM（Pulse Code Modulation，脉冲编码调制）格式存储或传输。PCM格式是一种无损编码格式，因为它直接存储了原始信号的采样值，没有任何压缩或编码损失。

#### 4.3.1 PCM文件结构

- **采样率**：PCM文件中通常包含采样率信息，表示每秒钟的采样次数。
- **量化位数**：PCM文件中还包含量化位数信息，表示每个采样点用多少位二进制数表示。
- **数据块**：PCM文件的主体部分是按时间顺序排列的二进制数据块，每个数据块表示一个采样点的量化值。

#### 4.3.2 PCM文件示例

假设我们有一个44.1 kHz采样率和16位量化的PCM音频文件，其文件结构如下：

- **文件头**：包含采样率（44100 Hz）和量化位数（16位）等信息。
- **数据块**：按时间顺序排列的二进制数据块，每个数据块表示一个采样点的量化值。

### 4.4 PCM编码的优缺点

- **优点**：
  - **无损**：PCM编码是一种无损编码格式，能够准确地重构原始模拟信号。
  - **简单**：PCM的编码和解码过程相对简单，计算量较小。
  - **广泛兼容**：PCM格式被广泛支持和兼容，几乎所有的数字音频设备和软件都支持PCM。
- **缺点**：
  - **数据量大**：由于PCM直接存储每个采样点的量化值，因此数据量较大，尤其是在高采样率和高量化位数的情况下。
  - **存储和传输成本高**：由于数据量大，PCM格式的音频文件在存储和传输时需要更多的存储空间和带宽。

参考：[音频处理——详解PCM数据格式_pcm格式-CSDN博客](https://blog.csdn.net/qq_28258885/article/details/120197122)

![二维码](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg)