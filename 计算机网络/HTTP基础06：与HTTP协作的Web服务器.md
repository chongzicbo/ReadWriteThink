### 1. 用单台虚拟主机实现多个域名

![image-20250103115223177](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103115223177.png)

#### 虚拟主机的概念
虚拟主机（Virtual Host）是一种技术，允许一台物理服务器模拟成多台独立的服务器。通过这种技术，一个服务器可以托管多个不同的域名，每个域名对应一个独立的网站。这种技术在Web托管服务中非常常见，因为它可以显著降低运营成本。

#### HTTP/1.1规范的支持
HTTP/1.1规范引入了对虚拟主机的支持。具体来说，HTTP/1.1允许在同一个IP地址上通过不同的主机名和域名来区分不同的Web站点。

#### 域名解析和请求处理
当客户端（例如浏览器）使用HTTP协议访问服务器时，通常会使用类似`www.example.com`的主机名和域名。域名通过DNS（域名系统）服务解析为IP地址。一旦解析完成，客户端就会向该IP地址发送HTTP请求。

在一个服务器上托管了多个域名（例如`www.example1.com`和`www.example2.com`）的情况下，当请求到达服务器时，服务器需要知道应该处理哪个域名。这就是虚拟主机发挥作用的地方。

#### Host首部的作用
为了区分不同的域名，HTTP/1.1引入了Host首部。当客户端发送HTTP请求时，可以在请求头中包含Host首部，指定具体的主机名或域名。例如：

```
GET /index.html HTTP/1.1
Host: www.example1.com
```

服务器在接收到请求后，会根据Host首部的内容来确定应该处理哪个域名。

#### 虚拟主机的实现
虚拟主机的实现依赖于服务器软件的配置。大多数现代Web服务器软件（如Apache、Nginx）都支持虚拟主机功能。通过在服务器配置文件中添加虚拟主机配置，可以为每个域名指定不同的网站目录和处理规则。

例如，在Apache服务器中，可以通过以下配置实现虚拟主机：

```
<VirtualHost *:80>
    ServerName www.example1.com
    DocumentRoot /var/www/example1
</VirtualHost>

<VirtualHost *:80>
    ServerName www.example2.com
    DocumentRoot /var/www/example2
</VirtualHost>
```

在这个例子中，当客户端请求`www.example1.com`时，服务器会使用`/var/www/example1`目录作为网站根目录；当请求`www.example2.com`时，服务器会使用`/var/www/example2`目录。

#### 总结
通过虚拟主机技术，一台物理服务器可以托管多个不同的域名，每个域名对应一个独立的网站。这种技术不仅提高了服务器的利用率，还使得多域名的Web托管变得更加方便和经济。HTTP/1.1规范通过引入Host首部，支持了虚拟主机的实现。

## 2. 通信数据转发程序：代理、网关、隧道

HTTP通信不仅仅是客户端和服务器之间的直接交互，还涉及一些中间应用程序，这些应用程序负责转发通信数据。这些中间应用程序包括代理、网关和隧道，它们在HTTP通信中扮演着重要的角色。

#### 代理

![代理](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103115541965.png)

**代理**是一种应用程序，充当客户端和服务器之间的“中间人”。它接收客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端。

- **基本行为**：代理服务器接收客户端的请求后，将其转发给源服务器，并将源服务器的响应返回给客户端。代理不改变请求的URI。

- **Via首部**：在HTTP通信过程中，代理服务器会在每次转发请求或响应时追加写入Via首部信息，以标记出经过的主机信息。

  ![Via首部](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103115604163.png)

- **缓存代理**：缓存代理会在转发响应时，将资源的副本（缓存）保存在代理服务器上。当再次接收到对相同资源的请求时，代理服务器可以直接从缓存中返回资源，而不需要再次从源服务器获取。

- **透明代理**：透明代理在转发请求或响应时不修改报文内容。与之相对的是非透明代理，会对报文内容进行加工。

#### 网关

![网关](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103115710764.png)

**网关**是一种服务器，它接收客户端的请求并将其转发给其他服务器，同时处理请求的方式就像它自己拥有资源一样。客户端通常不会察觉到自己的通信目标是一个网关。

- **协议转换**：网关可以将HTTP请求转换为其他协议的通信。例如，网关可以与数据库连接，使用SQL语句查询数据。

- **安全性**：网关可以在客户端与网关之间的通信线路上加密，以确保连接的安全性。例如，在Web购物网站上进行信用卡结算时，网关可以与信用卡结算系统联动。

  

#### 隧道

![隧道](./images/HTTP%E5%9F%BA%E7%A1%8006%EF%BC%9A%E4%B8%8EHTTP%E5%8D%8F%E4%BD%9C%E7%9A%84Web%E6%9C%8D%E5%8A%A1%E5%99%A8/image-20250103115741835.png)

**隧道**是一种应用程序，用于在客户端和服务器之间建立一条通信线路，并使用加密手段（如SSL）进行安全通信。隧道的目的是确保客户端和服务器之间的通信安全。

- **透明性**：隧道本身不会解析HTTP请求，请求保持原样中转给之后的服务器。隧道会在通信双方断开连接时结束。

### 总结

代理、网关和隧道是HTTP通信中重要的中间应用程序。代理负责转发请求和响应，网关可以进行协议转换和增强安全性，隧道则确保通信的安全性。这些中间应用程序在HTTP通信中起到了关键的作用，提升了系统的灵活性和安全性。

## 3. 保存资源的缓存

缓存是指代理服务器或客户端本地磁盘内保存的资源副本。利用缓存 可减少对源服务器的访问，因此也就节省了通信流量和通信时间。

### 缓存服务器

缓存服务器是代理服务器的一种，并归类在缓存代理类型中。换句话 说，当代理转发从服务器返回的响应时，代理服务器将会保存一份资 源的副本。

![缓存服务器](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103120042644.png)

- 优势：
  - 利用缓存可避免多次从源服务器转发资源。
  - 客户端可就近从缓存服务器上获取资源，而源服务器也不必多次处 理相同的请求了。

### 缓存的有效期限

即便缓存服务器内有缓存，也不能保证每次都会返回对同资源的请求。因为这关系到被缓存资源的有效性问题。当遇上源服务器上的资源更新时，如果还是使用不变的缓存，那就会演变成返回更新前的“旧”资源了。

即使存在缓存，也会因为客户端的要求、缓存的有效期等因素，向源服务器确认资源的有效性。若判断缓存失效，缓存服务器将会再次从源服务器上获取“新”资源。

![缓存有效期](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103120225532.png)

### 客户端缓存

![客户端缓存](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250103120308365.png)

缓存不仅可以存在于缓存服务器内，还可以存在客户端浏览器中。以Internet Explorer程序为例，把客户端缓存称为临时网络文件(Temporary Internet File)。

浏览器缓存如果有效，就不必再向服务器请求相同的资源了，可以直接从本地磁盘内读取。

另外，和缓存服务器相同的一点是，当判定缓存过期后，会向源服务器确认资源的有效性。若判断浏览器缓存失效，浏览器会再次请求新资源。