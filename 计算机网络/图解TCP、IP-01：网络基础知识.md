## 1.计算机网络出现的背景

1. **计算机的普及与多样化**：
   - 计算机已经广泛应用于社会的各个领域，包括办公室、工厂、学校、教育机关、实验室以及家庭。
   - 便携设备如笔记本电脑、平板电脑、智能手机等的普及率也在不断增加。
   - 计算机不仅存在于传统的计算机形态中，还嵌入到家用电器、音乐播放器、办公电器、汽车等设备中，形成了嵌入式计算机的广泛应用。
   - 计算机经历了一些列演变，从大型通用计算机、超级计算机、小型机、个人电脑、工作站、便携式电脑到如今的智能手机终端。性能逐年增强，价格逐年下降，集体规模逐渐变小

2. **从独立模式到网络互连模式**：

   ![独立模式](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108092220236.png)

   - 最初，计算机以单机模式（独立模式）被广泛使用，每个计算机之间相互独立。

     ![网络互联模式](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108092255546.png)

   - 随着计算机技术的发展，人们开始将计算机连接在一起，形成计算机网络，实现信息共享和远程通信。

3. **从计算机通信到信息通信**：

   ![局域网](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108092355918.png)

   - 最初的计算机网络是私有的，主要用于特定公司或实验室之间的连接。

     ![互联网](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108092427503.png)

   - 随着私有网络的不断发展，多个私有网络相互连接，形成了更大的网络，最终演变为互联网。

   - 互联网的出现极大地丰富了通信手段，使得计算机之间的通信不再局限于公司或部门内部，而是可以与互联网中的任何一台计算机进行通信。

4. **计算机网络的作用**：
   - 计算机网络类似于人的神经系统，将世界各地的信息传递到每个人的计算机中。
   - 随着互联网的普及，信息网络无处不在，社团成员、学校同窗之间可以通过邮件组、主页、BBS论坛、网络日志、聊天室、即时通信以及SNS实现互联与信息互换。

总结来说，计算机网络的背景是计算机技术的普及和多样化，以及人们对信息共享和远程通信需求的不断增加。计算机网络的发展经历了从单机模式到网络互连模式的转变，从私有网络到互联网的演变，最终形成了一个全球规模的综合通信环境。

## 2.计算机与网络发展的7个阶段

![七个阶段](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108100258025.png)

### 2.1 批处理

![批处理](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108095354692.png)

- **原因**：
  - 计算机在20世纪50年代开始普及，但价格昂贵且体积庞大，无法在普通办公场所使用。
  - 需要一种高效的方式来利用这些昂贵的计算机资源。

- **定义**：批处理系统是一种计算机操作模式，其中用户程序和数据被预先收集并存储在某种介质（如卡带或磁带）上，然后由计算机按照预定的顺序自动执行这些程序和处理数据。

- **原理**：批处理的原理基于将多个用户的任务集合在一起，形成一个任务批次，然后一次性提交给计算机处理。这样可以充分利用计算机的计算能力，减少空闲时间，提高效率。由于早期的计算机操作复杂且昂贵，批处理系统通过自动化的方式减少了人工干预的需求，使得计算机能够处理大量数据和任务。
- **优点**：
  - 提高了计算机的利用率，减少了空闲时间。
  - 适用于大规模数据处理任务。

- **缺点**：
  - 用户无法实时监控程序的执行情况。
  - 程序处理时间较长，用户需要等待结果。
  - 计算机操作复杂，需专门的操作员处理。

### 2.2 分时系统

![分时系统](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108095628756.png)

- **原因**：
  - 20世纪60年代，计算机造价昂贵，一人一台专有计算机不现实。
  - 需要一种方式让用户感觉像是在使用自己的计算机。

- **定义**：分时系统是一种允许多个用户通过各自的终端同时访问和使用一台计算机的系统。

- **原理**：分时系统的核心在于时间共享。计算机通过高速切换处理器的时间片，使得每个用户感觉好像独占了整台计算机。这种系统通过通信线路将多个终端连接到中央计算机，中央计算机在每个时间片内处理一个用户的请求，然后将结果返回给相应的终端。这样，多个用户可以同时进行交互操作，提高了计算机的利用率和用户体验。
- **优点**：
  - 提高了计算机的可用性和交互性。
  - 促进了BASIC等编程语言的发展。
  - 使计算机更加人性化，贴近生活。

- **缺点**：
  - 计算机性能要求高，需支持多用户同时操作。

### 2.3 计算机之间的通信

![计算机之间的通信](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108095726612.png)

- **原因**：
  - 20世纪70年代，计算机性能提升，价格下降，企业开始使用计算机。
  - 需要一种方式在企业内部各部门之间共享数据和资源。

- **定义**：计算机之间的通信是指通过网络连接，使不同的计算机能够相互传输数据和信息，从而实现资源共享和协同工作。

- **原理**：计算机之间的通信依赖于通信协议和网络硬件。早期的通信方式包括使用串行通信线路（如RS-232）或局域网（LAN）技术。通过这些连接，计算机可以发送和接收数据包，实现数据的即时传输。这种通信方式大大缩短了数据传输的时间，提高了计算机的可用性和灵活性。
- **优点**：
  - 提高了计算机的可用性，促进了分布式处理。
  - 使企业内部各部门可以独立使用计算机处理数据。

- **缺点**：
  - 数据传输速度受限于通信线路的带宽。

### 2.4 计算机网络的产生

![计算机网络的产生](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108095812547.png)

- **原因**：
  - 20世纪80年代，计算机普及，窗口系统的发展使用户可以同时执行多个程序。
  - 需要一种方式将不同类型的计算机连接起来，实现资源共享和信息交换。
- **定义**：计算机网络是指通过通信线路将多台计算机连接起来，形成一个可以相互通信和资源共享的系统。
- **原理**：计算机网络的基础是分组交换技术。在这种技术中，数据被分割成小的数据包，每个数据包包含源地址和目的地址。数据包通过网络中的路由器逐跳传输，最终到达目的地。这种技术允许不同类型的计算机和网络设备互连，形成一个统一的网络系统，促进了信息资源的共享和分布式计算的发展。
- **优点**：
  - 提高了计算机的灵活性和可用性。
  - 促进了窗口系统与网络的结合，使用户可以自由地进行网上冲浪和资源访问。
- **缺点**：
  - 需要解决不同厂商计算机之间的兼容性问题。

### 2.5 互联网的普及

![窗口系统](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108095929604.png)

![互联网](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108100103798.png)

- **原因**：
  - 20世纪90年代，信息处理公司和大学已为每位员工或研究人员分配了一台计算机。
  - 需要一种低成本的网络环境来连接不同厂商的计算机。
- **定义**：互联网是指通过TCP/IP协议将全球范围内的计算机网络连接起来，形成一个庞大的信息交换和资源共享系统。
- **原理**：互联网的核心是TCP/IP协议。TCP（传输控制协议）负责确保数据包的可靠传输，IP（互联网协议）负责数据包的路由和转发。通过这些协议，不同网络之间的计算机可以相互通信，形成一个统一的网络空间。互联网的普及得益于其开放性和标准化，使得各种设备和系统能够无缝连接，促进了信息技术的快速发展。
- **优点**：
  - 促进了电子邮件、万维网等信息传播方式的发展。
  - 使互联网从公司范围扩展到家庭内部，广泛普及。
- **缺点**：
  - 需要解决网络安全和隐私保护问题。

### 2.6 以互联网技术为中心的时代

![IP网](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108100127725.png)

- **原因**：
  - 互联网的快速发展影响了通信领域，电话网逐渐被IP网取代。
  - 需要一种统一的技术来实现多种设备的互联。
- **定义**：以互联网技术为中心的时代是指信息技术的发展和应用以互联网为核心，推动各种设备和系统的互联和智能化。
- **原理**：这一时代的特征是IP技术的广泛应用。IP技术不仅用于计算机之间的通信，还扩展到电话、电视、家用电器等多种设备。通过IP网络，这些设备可以实现互联互通，形成一个统一的智能网络。这种技术的发展推动了物联网（IoT）和云计算等新兴技术的兴起，极大地丰富了人们的生活和工作方式。
- **优点**：
  - 扩展了联网设备的种类，促进了多种设备的互联。
  - 提高了信息传播的效率和便捷性。
- **缺点**：
  - 需要解决设备兼容性和网络安全问题。

### 2.7 从“单纯建立连接”到“安全建立连接”

- **原因**：
  - 互联网的便捷性带来了计算机病毒、信息泄露、网络欺诈等负面影响。
  - 需要在建立连接的同时考虑安全问题。

- **定义**：从“单纯建立连接”到“安全建立连接”是指在互联网普及的基础上，更加注重网络安全和防护，确保连接的可靠性和安全性。

- **原理**：随着互联网的广泛应用，网络安全问题日益突出。为了应对这些问题，人们在建立连接时不仅要考虑连接的便捷性，还要采取各种安全措施，如防火墙、加密技术、入侵检测系统等。这些措施可以有效地防止网络攻击和数据泄露，保障网络的安全性和可靠性。
- **优点**：
  - 提高了网络的安全性和可靠性，减少了网络犯罪行为。
  - 保障了公司业务和个人生活的正常开展。

- **缺点**：
  - 需要投入更多的资源和精力来维护网络安全。

### 2.8 手握金刚钻的 TCP/IP

TCP/IP是一组通信协议，是互联网的基础，负责在不同计算机和网络之间传输数据。

TCP/IP协议包括多个层次，如应用层、传输层、网络层和链路层。每一层负责不同的功能，如应用层处理具体的应用协议（如HTTP、FTP），传输层负责数据的可靠传输（如TCP、UDP），网络层负责数据包的路由和转发（如IP），链路层负责物理连接和数据帧的传输。通过这些层次的协同工作，TCP/IP协议实现了不同计算机和网络之间的无缝连接和数据传输。

### 总结

| 阶段                             | 背景或原因                                                   | 定义                                                       | 优点                                                        | 缺点                                                     |
| -------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- | ----------------------------------------------------------- | -------------------------------------------------------- |
| 批处理                           | 计算机昂贵且体积庞大，无法在一般办公场所使用。               | 用户程序和数据预先装入卡带或磁带，由计算机按顺序批量处理。 | 提高了计算机的利用率，适用于大规模计算。                    | 用户无法实时监控程序执行，需专门操作员处理，处理时间长。 |
| 分时系统                         | 计算机造价昂贵，一人一台专有计算机费用不现实。               | 多个终端与同一计算机连接，允许多个用户同时使用。           | 提高了计算机的可用性和交互性，促进了BASIC等编程语言的发展。 | 计算机性能要求高，需支持多用户同时操作。                 |
| 计算机之间的通信                 | 计算机性能提升，价格下降，企业开始使用计算机。               | 研究计算机与计算机之间的通信技术。                         | 提高了计算机的可用性，促进了分布式处理。                    | 数据传输速度受限于通信线路的带宽。                       |
| 计算机网络的产生                 | 计算机普及，窗口系统的发展使用户可以同时执行多个程序。       | 基于分组交换技术的计算机网络，能够互连多种计算机。         | 提高了计算机的灵活性和可用性，促进了窗口系统与网络的结合。  | 需要解决不同厂商计算机之间的兼容性问题。                 |
| 互联网的普及                     | 信息处理公司和大学已为每位员工或研究人员分配了一台计算机。   | 通过连接不同厂商的计算机建立一个成本更低的网络环境。       | 促进了电子邮件、万维网等信息传播方式的发展，广泛普及。      | 需要解决网络安全和隐私保护问题。                         |
| 以互联网技术为中心的时代         | 互联网的快速发展影响了通信领域，电话网逐渐被IP网取代。       | 各种网络技术向互联网靠拢，IP网是互联网技术的产物。         | 扩展了联网设备的种类，促进了多种设备的互联。                | 需要解决设备兼容性和网络安全问题。                       |
| 从“单纯建立连接”到“安全建立连接” | 互联网的便捷性带来了计算机病毒、信息泄露、网络欺诈等负面影响。 | 追求“安全建立连接”的目标，确保通信网络的安全性和可靠性。   | 提高了网络的安全性和可靠性，减少了网络犯罪行为。            | 需要投入更多的资源和精力来维护网络安全。                 |

## 3.协议

### 3.1 随处可见的协议

- 在计算机网络与信息通信领域里，“协议”随处可见。代表性的互联网协议有IP、TCP、HTTP，局域网的IPX/SPX协议等
- TCP/IP是IP、TCP、HTTP等协议的集合；Novell公司的IPX/SPX；苹果公司的AppleTalk等

![协议](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108101312044.png)

### 3.2 协议的必要性

- 在日常使用网络时，人们通常不会意识到协议的存在，但在网络配置和通信过程中，协议起到了至关重要的作用。

- 协议是计算机之间通过网络实现通信的“约定”，使得不同设备、CPU和操作系统能够相互通信。如果使用的协议不同，通信将无法实现，就像不同国家的人使用不同语言无法相互理解一样。

- 协议有多种类型，每种协议都有明确的行为规范，只有支持并遵循相同的协议，计算机之间才能实现相互通信。

- 协议如同人与人的对话，对话双方需要使用相同的语言，否则没法沟通。

  ![协议如同语言](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108102925806.png)

### 3.3 计算机中的协议

![协议约定](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108103137559.png)

1. **人类与计算机的沟通差异**：
   - 人类具备掌握知识和应用能力，能够自然适应沟通规则。
   - 计算机通信需要严格的协议，因为计算机智能水平尚未达到人类高度。
2. **计算机通信的基本要求**：
   - 计算机从物理连接到应用程序各层面都必须遵循事先达成的约定。
   - 每台计算机必须具备实现通信基本功能的程序。
3. **协议的重要性**：
   - 协议是计算机之间通信的详细约定，确保各组件能够正确理解和执行指令。
   - 设计软件和硬件时需考虑通信过程中可能出现的异常及其处理。

### 3.4 分组交换协议

![分组交换](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108103251339.png)

1. **分组交换的定义**：
   - 分组交换是将大数据分割成较小的单位（包或Packet）进行传输的方法。
   - 这些包类似于邮局里的邮包。
2. **分组交换的过程**：
   - 大数据被分割成多个小分组。
   - 每个分组带有报文首部，包含源主机地址、目标主机地址和分组序号。
   - 分组从源主机发送到目标主机，目标主机根据报文首部重新组装原始数据。
3. **报文首部的作用**：
   - 报文首部包含发送端和接收端的地址信息以及分组序号。
   - 这些信息帮助接收端正确识别和重新组装数据。
4. **通信协议的作用**：
   - 通信协议规定了报文首部应包含的信息及处理方式。
   - 各计算机根据协议构造和读取报文首部，以确保通信的正确性。
   - 发送方和接收方需要对报文首部和内容有一致的定义和解释。
5. **标准化过程**：
   - 为了不同厂商的计算机能够相互通信，存在一个组织负责制定通信协议的规范和国际通用标准。

## 4.协议由谁规定

### 4.1 计算机通信的诞生及其标准化

![通信标准化](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108103841688.png)

1. **初期状况**：
   - 计算机通信诞生之初，系统化与标准化未得到足够重视。
   - 各计算机厂商推出各自的网络产品，缺乏统一的协议和标准。

2. **IBM的SNA**：
   - 1974年，IBM发布了SNA（Systems Network Architecture），将其作为系统化网络体系结构公之于众。
   - 这引发了其他计算机厂商发布各自的网络体系结构，推动了协议的系统化进程。

3. **兼容性问题**：
   - 各厂商的网络体系结构和协议不兼容，即使物理上连接了两台异构计算机，也无法实现正常通信。
   - 用户面临不便，必须使用同一厂商的产品，厂商破产或产品过期需更换整套设备。
   - 不同部门间的网络产品不兼容，物理连接也无法实现通信。

4. **灵活性和可扩展性缺乏**：
   - 用户对计算机通信的应用受到限制，难以自如使用。

5. **兼容性的重要性**：
   - 随着计算机重要性提高，公司意识到兼容性的重要意义。
   - 开始研究使不同厂商生产的异构机型能够互相通信的技术，促进了网络的开放性和多供性。

### 4.2 协议的标准化

![标准化](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108104203064.png)

- 为了解决兼容性问题，ISO制定了一个国际标准OSI，对通信系统进行标准化。OSI没有得到普及，但是为网络协议的指定提供了参考指导。
- 这里要说的TCP/IP指的是IETF推进的标准化协议。



## 5.协议分层与OSI参考模型

### 5.1 协议分层

![协议分层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108110309944.png)

1. **OSI参考模型的目的**：
   - ISO在制定标准化OSI之前，对网络体系结构相关的问题进行了充分讨论，最终提出了OSI参考模型。
   - 该模型将通信协议中必要的功能分成了7层，使得复杂的网络协议更加简单化。
2. **分层结构**：
   - 每个分层都接收由它下一层所提供的特定服务，并且负责为自己的上一层提供特定的服务。
   - 上下层之间进行交互时所遵循的约定叫做“接口”。
   - 同一层之间的交互所遵循的约定叫做“协议”。
3. **分层的优点**：
   - 分层可以将每个分层独立使用，即使系统中某些分层发生变化，也不会波及整个系统。
   - 可以构造一个扩展性和灵活性都较强的系统。
   - 通过分层能够细分通信功能，更易于单独实现每个分层的协议，并界定各个分层的具体责任和义务。
4. **分层的劣势**：
   - 可能在于过分模块化，使处理变得更加沉重。
   - 每个模块都不得不实现相似的处理逻辑等问题。
5. **通过对话理解分层**

![通过对话理解分层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108110608224.png)

表面上看A跟C是在用汉语直接对话，但实际上A与C都是在通过电话机的听筒听取声音，都在对着麦克风说话。
其实在这个图中，他们所用的语言协议作为麦克风的音频输人，在通信设备层被转换为电波信号传送出去了。传送到对方的电话机后，又被通信设备层转换为音频输出，传递给了对方。因此，A与C其实是利用电话机之间通过音频转化声音的接口实现了对话。

### 5.2 OSI参考模型

![OSI参考模型](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108111013601.png)

- OSI参考模型只是对各层的作用做了一系列粗略界定，没有对协议和接口进行详细的定义。只能起到引导作用。

![OSI各层作用](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108111216405.png)

| 层次       | 主要功能                                                     |
| ---------- | ------------------------------------------------------------ |
| 应用层     | 为应用程序提供服务并规定应用程序中通信相关的细节。包括文件传输、电子邮件、远程登录（虚拟终端）等协议。 |
| 表示层     | 将应用处理的信息转换为适合网络传输的格式，或将来自下一层的数据转换为上层能够处理的格式。主要负责数据格式的转换，使不同设备对同一比特流的解释结果保持一致。 |
| 会话层     | 负责建立和断开通信连接（数据流动的逻辑通路），以及数据的分割等数据传输相关的管理。 |
| 传输层     | 起着可靠传输的作用。只在通信双方节点上进行处理，而无需在路由器上处理。 |
| 网络层     | 将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而成的某一个地址。主要负责寻址和路由选择。 |
| 数据链路层 | 负责物理层面上互连的、节点之间的通信传输。例如与1个以太网相连的2个节点之间的通信。将0、1序列划分为具有意义的数据帧传送给对端（数据帧的生成与接收）。 |
| 物理层     | 负责0、1比特流（0、1序列）与电压的高低、光的闪灭之间的互换。 |

## 6.OSI参考模型通信处理举例

### 6.1 7层通信

![七层通信](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108113008841.png)

### 6.2 邮件发送案例

![邮件发送](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108114412983.png)

#### 6.2.1 应用层

![应用层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108114520049.png)

- 应用层是OSI模型的最高层，负责与应用程序交互，提供网络服务给最终用户。
- **作用**：用户通过电子邮件客户端（如Outlook、Gmail等）创建并发送邮件。
  - **用户界面**：
    - 提供用户界面，让用户能够编写、编辑和发送邮件。
    - 收集用户的输入信息，如收件人地址、邮件主题和正文内容。
  - **协议处理**：
    - 使用SMTP（Simple Mail Transfer Protocol）协议来发送邮件。
    - 使用POP3（Post Office Protocol Version 3）或IMAP（Internet Message Access Protocol）协议来接收邮件。
  - **数据封装**：
    - 将邮件内容封装成符合SMTP协议的数据包。
    - 添加必要的头部信息，如发件人、收件人、主题等。
  - **错误处理**：
    - 处理邮件发送过程中可能出现的错误，如收件人邮箱不存在、服务器连接失败等。
    - 如果邮件发送失败，向用户返回错误信息。
  - **存储管理**：
    - 在发送端，将邮件暂存到本地缓存或队列中，等待发送。
    - 在接收端，将接收到的邮件存储到用户的邮箱中。
- 具体步骤：
  - 用户在主机A上新建一封电子邮件，指定收件人为B，并输入邮件内容为“早上好”。
  - 应用层使用SMTP协议封装邮件，生成一个包含邮件头和邮件体的数据包。

#### 6.2.2 表示层

![表示层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108114754485.png)

- 表示层是OSI模型的第六层，主要负责数据的表现形式和编码转换。
- **作用**：将数据从主机特有的格式转换为网络标准传输格式。
  - **数据格式转换**：
    - 将主机特有的数据格式（如特定的文本编码、图像格式等）转换为网络通用的标准格式。
    - 例如，将特定的文本编码（如EUC-JP、Shift_JIS等）转换为通用的编码格式（如UTF-8）。
  - **数据压缩和解压缩**：
    - 对数据进行压缩以减少传输的数据量。
    - 在接收端对数据进行解压缩以恢复原始数据。
  - **加密和解密**：
    - 对敏感数据进行加密以保护数据的安全性。
    - 在接收端对加密的数据进行解密以恢复原始数据。
  - **错误检测**：
    - 使用校验码或其他机制检测数据传输中的错误。
- 具体步骤：
  - 将邮件内容从主机特有的格式（如HTML、富文本等）转换为网络通用的标准格式（如ASCII编码）。
  - 可能还会进行数据压缩或加密处理。

#### 6.2.3 会话层

![会话层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108114949896.png)

- 会话层是OSI模型的第五层，主要负责建立、管理和终止通信会话。
- **作用**：管理连接和会话，确保数据高效地进行交互。
  - **连接管理**：
    - 确定采用哪种连接方法来发送数据。
    - 可以选择每封邮件建立一次连接，随后断开连接；也可以一次性建立多个连接，同时发送多封邮件。
  - **会话控制**：
    - 控制会话的开始和结束。
    - 管理会话的状态，确保数据按正确的顺序传输。
  - **同步控制**：
    - 确保数据在传输过程中保持同步。
    - 使用同步点来恢复会话，例如在发生错误时重新同步。
  - **首部信息**：
    - 在收到的数据前端附加首部或标签信息，记录数据传送顺序的信息。
    - 这些首部或标签信息帮助下一层处理数据。
- 具体步骤：
  - 确定通信双方的身份和权限。
  - 建立和维护连接，确保数据传输的顺序性和完整性。
  - 在数据前端附加首部或标签信息，记录数据传送顺序的信息。

#### 6.2.4 传输层

![传输层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108115105320.png)

- 传输层是OSI模型的第四层，主要负责确保数据可靠传输。
- **作用**：确保数据可靠传输。
  - **建立连接**：
    - 确保与目标主机之间的通信连接。
    - 这一过程通常称为“三次握手”。
  - **数据传输**：
    - 将数据分割成适当大小的数据段，并为每个数据段添加首部信息。
    - 使用TCP协议（Transmission Control Protocol）来保证数据的可靠传输。
  - **错误检测和重传**：
    - 检测数据传输过程中可能出现的错误。
    - 如果数据包丢失或损坏，传输层会请求重新传输这些数据包。
  - **流量控制**：
    - 控制数据传输速率，以防止接收方被过多的数据淹没。
  - **拥塞控制**：
    - 调整数据传输速率，以避免网络拥塞。
- 具体步骤：
  - 使用TCP协议建立连接。
  - 将邮件数据分割成适当大小的数据段，并为每个数据段添加首部信息（如源端口号、目标端口号、序列号等）。
  - 检测错误并请求重传（例如，使用CRC校验和确认机制）。
  - 控制数据传输速率，以防止接收方被过多的数据淹没。

#### 6.2.5 网络层

![网络层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108115203875.png)

- 网络层是OSI模型的第三层，主要负责将数据包从源主机路由到目标主机。
- **作用**：负责将数据包路由到正确的目的地。
  - **路由选择**：
    - 确定数据包从源主机到目标主机的最佳路径。
    - 使用IP地址来标识网络中的设备。
  - **寻址**：
    - 使用IP地址来确定数据包的目的地。
    - 确保数据包能够到达正确的主机。
  - **分段和重组**：
    - 将较大的数据包分割成较小的数据段，以便在网络中传输。
    - 在接收端重新组装这些数据段。
  - **错误检测**：
    - 检测数据包传输过程中可能出现的错误。
    - 通常不负责重传，但可以标记错误的数据包。
- 具体步骤：
  - 使用IP地址确定数据包的目的地。
  - 将数据包封装成IP数据报，并添加源IP地址和目标IP地址。
  - 使用路由表选择最佳路径，将数据包转发到下一个路由器或直接到达目标主机。
  - 处理网络拥塞和流量控制。

#### 6.2.6 数据链路层

![数据链路层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108115357643.png)

- **作用**：负责在相邻节点之间传输数据帧。
  - **帧封装**：
    - 将来自网络层的数据包封装成帧，并添加帧头和帧尾信息。
    - 帧头包含源MAC地址和目标MAC地址。
  - **错误检测**：
    - 使用CRC（循环冗余校验）等机制检测传输过程中可能出现的错误。
    - 如果检测到错误，可以请求重传。
  - **流量控制**：
    - 控制数据传输速率，以防止接收方被过多的数据淹没。
  - **介质访问控制**：
    - 管理对共享介质的访问，例如使用CSMA/CD（载波监听多路访问/冲突检测）协议。
- 具体步骤：
  - 将来自网络层的数据包封装成帧，并添加帧头和帧尾信息（如源MAC地址、目标MAC地址、CRC校验码等）。
  - 使用CSMA/CD等介质访问控制协议，确保数据帧能够正确地传输到下一跳设备。
  - 检测传输过程中可能出现的错误，并请求重传。

#### 6.2.7 物理层

![物理层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108115515511.png)

- **作用**：负责实际的数据传输。
  - **信号传输**：
    - 将二进制数据（0和1）转换为电信号或光信号。
    - 通过物理介质（如电缆、光纤等）传输这些信号。
  - **同步**：
    - 确保发送端和接收端之间的时钟同步。
  - **物理连接**：
    - 建立和维护物理连接。
- 具体步骤：
  - 将二进制数据（0和1）转换为电信号或光信号。
  - 通过物理介质（如电缆、光纤等）传输这些信号。
  - 确保发送端和接收端之间的时钟同步。

### 6.3 邮件发送具体步骤

1. **用户A** 创建邮件并点击发送按钮。

2. **应用层** 接收到用户输入的信息，并使用SMTP协议封装邮件。

3. **表示层** 将邮件内容从主机特有的格式转换为网络通用的标准格式。

4. **会话层** 管理连接和会话，决定采用哪种连接方法。

5. 传输层 确保数据可靠传输：

   - 建立连接。
   - 将数据分割成数据段，并为每个数据段添加首部信息。
   - 检测错误并请求重传。

6. 网络层

   负责路由选择：

   - 使用IP地址确定数据包的目的地。
   - 将数据包路由到正确的网络路径。

7. 数据链路层

   负责在相邻节点之间传输数据帧：

   - 将来自网络层的数据包封装成帧，并添加帧头和帧尾信息。
   - 使用CRC等机制检测传输过程中可能出现的错误。

8. 物理层  负责实际的数据传输：

   - 将二进制数据转换为电信号或光信号。
   - 通过物理介质传输这些信号。

9. **主机B** 的物理层接收到信号，并将其转换回二进制数据。

10. **数据链路层** 解封装帧，并将数据包转发给网络层。

11. **网络层** 确认数据包到达正确的目的地，并将其转发给传输层。

12. **传输层** 确认数据是否完整，并将其转发给会话层。

13. **应用层** 将邮件存储到用户的邮箱中。

14. **用户B** 登录邮箱后，应用层使用POP3或IMAP协议从服务器下载邮件。

## 7.传输方式的分类

### 7.1 面向有连接型与面向无连接型

![有连接型和无连接型](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108120839768.png)

#### 面向有连接型

- **特点**：在发送数据之前，需要在收发主机之间建立一条通信线路。
- 过程：
  - 建立连接：类似于打电话，拨号后等待对方接听。
  - 数据传输：连接建立后，可以进行数据的发送与接收。
  - 断开连接：数据传输完成后，需要断开连接。

#### 面向无连接型

- **特点**：不需要事先建立连接，发送端可以在任何时候自由地发送数据。
- 过程：
  - 发送数据：发送端直接发送数据，无需确认接收端是否准备好接收。
  - 接收数据：接收端在收到数据时处理，无需事先确认发送端的状态。

#### 对比

- **面向有连接型**：适用于需要保证数据可靠传输的场景，如文件传输、视频通话等。
- **面向无连接型**：适用于对实时性要求较高但对可靠性要求较低的场景，如网络广播、实时监控等。

### 7.2 电路交换和分组交换

以下是添加了优缺点后的电路交换和分组交换的内容：

#### 电路交换
- **历史与应用**：历史相对久远，主要用于过去的电话网。
- **工作原理**：
    - 计算机先连接到交换机，交换机间由众多通信线路连接。计算机发送数据时，需通过交换机与目标主机建立通信电路（称为建立连接），连接建立后，用户可一直使用该电路，直到连接被断开。
    - 若某条电路仅连接两台计算机，它们可独占线路通信；但若一条电路连接多台计算机，它们相互传递数据时，会出现新问题，一台计算机发送信息会独占电路，其他计算机需等待其处理结束才有机会使用电路收发数据，且无法预测某台计算机的数据传输起止时间，若并发用户数超交换机间通信线路数，通信无法实现。
- **优点**：
    - 通信时延小：一旦电路建立，数据传输就像在专用通道上进行，没有排队等待等延迟，实时性强，适合对时延要求高的业务，如语音通话。
    - 有序传输：数据按照发送顺序传输，不会出现乱序现象，接收端处理简单。
    - 没有冲突：因为是独占线路，不会出现多个用户同时争抢线路资源而产生冲突的情况。
- **缺点**：
    - 建立连接时间长：需要预先建立电路连接，这个过程可能会花费一定时间，不适合突发性的数据传输。
    - 线路利用率低：即使在通信的空闲时段，线路也被独占，不能被其他通信使用，造成资源浪费。
    - 灵活性差：难以适应数据传输速率、格式等的变化，当通信需求发生变化时，无法快速调整。

#### 分组交换

![分布交换](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108121448485.png)

- **历史与应用**：是一种较新的通信方式，从20世纪60年代后半叶才开始逐渐被认可，目前广泛应用的TCP/IP正是采用了分组交换技术。
- **工作原理**：
    - 计算机将所要发送的数据分成多个数据报，按一定顺序排列后分别发送，即分组交换。分组后，所有计算机可一齐收发数据，提高了通信线路利用率。
    - 分组过程中，在每个分组的首部写入发送端和接收端的地址，所以即使同一条线路为多个用户服务，也能明确区分每个分组数据的目的地及与哪台计算机通信。
    - 由分组交换机（路由器）连接通信线路，发送端计算机将数据分组发送给路由器，路由器收到后缓存到自己的缓冲区，再按先进先出的顺序逐一发送给目标计算机，因此分组交换也叫蓄积交换。
    - 计算机与路由器之间以及路由器与路由器之间通常只有一条通信线路，是共享线路。通信线路速度可能因网络拥堵而不同，数据达到目标地址的时间有长有短，路由器缓存饱和或溢出时，可能发生分组数据丢失、无法发送到对端的情况。
    
    ![特点](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108121510307.png)
- **优点**：
    - 高效：可以实现多个用户共享线路，提高了线路的利用率，尤其在数据传输具有突发性时，能更好地利用网络资源。
    - 灵活：可以适应不同的数据传输速率、格式等，便于网络的扩展和升级。
    - 可靠性高：当网络中某个节点或链路出现故障时，分组可以通过其他路径传输，具有较强的容错能力和鲁棒性。
- **缺点**：
    - 时延较大：由于分组需要在路由器中进行存储转发，还可能会因为网络拥塞等原因排队等待，导致时延较大，实时性相对较差。
    - 开销大：每个分组都需要添加首部信息，包含源地址、目的地址等，增加了数据传输的开销。
    - 可能出现丢包：在网络拥塞严重时，路由器的缓存可能溢出，导致分组丢失，需要上层协议进行重传等处理，增加了系统的复杂性。

综上所述，电路交换和分组交换各有优劣，在不同的应用场景中会根据具体需求选择合适的通信方式。例如，对于对实时性要求极高且数据传输稳定的场景，电路交换可能更合适；而对于大多数现代网络应用，如互联网，分组交换的优势使其成为主流的通信方式。

### 7.3 根据接收端数量分类

![接收端数量分类](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108121724184.png)

在网络通信中，可依据目标地址个数及其后续行为对通信分类，主要有以下几种：

#### 单播（Unicast）
- **含义**：“Uni”表示“1”，“Cast”意为“投掷”，组合起来指1对1通信。
- **示例**：早先的固定电话是单播通信的典型例子，好比学生与老师之间、同学与同学之间一对一对话。

#### 广播（Broadcast）
- **含义**：字面有“播放”之意，指将消息从1台主机发送给与之相连的所有其他主机。
- **示例**：电视播放是广播通信的典型例子，它将电视信号一齐发送给非特定的多个接收对象。此外，进行广播通信的计算机有广播范围，只有在该范围内的计算机才能收到广播消息，此范围叫广播域。

#### 多播（Multicast）
- **含义**：与广播类似，也是将消息发给多个接收主机，但多播要限定某一组主机作为接收端。
- **示例**：电视会议是多播最典型的例子，这是由多组人在不同地方参加的远程会议，由一台主机发送消息给特定的多台主机，电视会议通常不能用广播方式，否则无法掌握参会人员位置。

#### 任播（Anycast）
- **含义**：是指在特定的多台主机中选出一台作为接收端的通信方式，从目标主机群中选择最符合网络条件的主机作为目标主机发送消息，所选特定主机将返回一个单播信号，随后发送端只跟这台主机通信。
- **示例**：任播在实际网络中的应用有DNS根域名解析服务器

这些通信方式各有特点和适用场景，单播用于点对点通信，广播是一对多的广泛传播，多播针对特定组，任播则是从特定组中选择最优主机进行通信。

| 通信方式          | 含义                                                         | 示例                                                   | 特点                                               |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------ | -------------------------------------------------- |
| 单播（Unicast）   | “Uni”表示“1”，“Cast”意为“投掷”，指1对1通信                   | 早先的固定电话，学生与老师、同学与同学之间一对一对话   | 点对点通信，针对性强                               |
| 广播（Broadcast） | 字面有“播放”之意，将消息从1台主机发送给与之相连的所有其他主机 | 电视播放，将电视信号发送给非特定多个接收对象，有广播域 | 一对多广泛传播，无特定接收组限制                   |
| 多播（Multicast） | 与广播类似，将消息发给多个接收主机，但限定某一组主机作为接收端 | 电视会议，由一台主机发送消息给特定多台主机             | 针对特定组主机，比广播更有针对性，避免不必要的传播 |
| 任播（Anycast）   | 在特定多台主机中选出一台作为接收端，从目标主机群中选最符合网络条件的主机发送消息，所选主机返回单播信号后，发送端只与该主机通信 | DNS根域名解析服务器（将在5.2节介绍）                   | 从特定组中选择最优主机通信，提高通信效率和质量     |

## 8.地址

### 通信主体与地址标识

- 发送端和接收端是通信主体，可由 “地址” 信息标识，现实生活中如电话号码、通信地址加姓名等，而计算机通信中地址概念更复杂，不同协议层使用不同地址，如 TCP/IP 通信中有 MAC 地址、IP 地址、端口号等，应用层还有电子邮件地址等。

### 地址的唯一性

- 地址要在通信中发挥作用，需明确通信主体，同一通信网络中不允许有两个相同地址的通信主体存在。单播通信中，地址唯一性好理解，因为通信两端是单一主机；广播、多播、任播通信中，接收端设备可能多个，可对由多个设备组成的一组通信赋予同一个具有唯一性的地址来避免歧义，明确接收对象。
- 例如，老师说 “一年一班的同学们请起立”，“一年一班” 是多播的目标地址，具有唯一性；老师说 “一年一班的哪位同学过来把你们班的学习资料取走”，“一年一班的哪位同学”（任意一位同学）是任播的目标地址，也具有唯一性。通过这些例子说明在不同通信方式下，如何通过具有唯一性的地址来准确标识通信对象。

![地址唯一性举例](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108134045663.png)

### 地址层次性

![地址层次性](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108134231424.png)

#### 地址层次性的必要性

- **地址数量增多的挑战**：当地址总数不多时，凭借唯一地址可定位通信主体，但地址总数增多后，高效找出目标地址成为重要问题，因此地址需具备层次性，以便更快速地定位地址。例如电话号码包含国家区号和国内区号，通信地址包含国名、省名、市名和区名等，这些都是地址分层的体现。

#### MAC 地址与 IP 地址的对比

- MAC 地址：
  - **唯一性**：由设备制造厂商针对每块网卡分别指定，通过制造商识别号、制造商内部产品编号以及产品通用编号确保唯一性。
  - **层次性不足**：虽然其中的信息在某种程度上有层次性，但对寻找地址无实际作用，不能算作有层次的地址。它是负责最终通信的地址，但在实际寻址过程中，仅靠 MAC 地址难以高效定位，IP 地址不可或缺。
- IP 地址：
  - **层次性体现**：由网络号和主机号两部分组成。即使通信主体的 IP 地址不同，若主机号不同而网络号相同，说明它们处于同一个网段，且通常同网段的主机在组织结构、提供商类型和地域分布上较集中，这为 IP 寻址带来极大方便，体现了 IP 地址的层次性。

#### IP 地址的分层寻址过程

- **路由控制表与地址转发**：在网络传输中，每个节点依据组织的地址信息判断报文该由哪个网卡发送出去。各个地址会参考一个发出接口列表，MAC 寻址参考的叫地址转发表，IP 寻址参考的叫路由控制表。MAC 地址转发表记录的是实际的 MAC 地址本身，而路由表中记录的 IP 地址是集中后的网络号。
- **示例说明**：如主机 A 先查看自己的路由控制表，再据此将发往主机 β 的数据先发给路由器 1；接收到该数据的交换机 1 根据自己的地址转发表将数据转发给路由器 1；路由器 1 根据自己的路由控制表将数据发给路由器 3；路由器 3 根据路由控制表将数据转发给交换机 3；交换机 3 再根据自己的地址转发表将数据发给主机 β。

## 9.网络的构成要素

![网络的构成要素](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108134524252.png)

![网络主要设备](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108134629317.png)

### 9.1 通信媒介与数据链路

![数据链路](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108134732768.png)

### 9.2 网卡（Network Interface Card，NIC）

![网卡](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108135256208.png)

- **定义与别称**：任何计算机连接网络时必须使用网卡，全称为网络接口卡，有时也被叫做网络适配器、网卡、LAN 卡。
- 连接网络的要求：
  - **以太网连接**：最近很多产品目录加入 “内置 LAN 端口” 参数，说明越来越多计算机出厂设置具备以太网（Ethernet）1000BASE - T 或 100BASE - TX 端口。没有配置 NIC 的计算机若接入以太网，至少得外接扩展槽以便插入 NIC。
  - **无线局域网连接**：无线局域网情况下，计算机必须具备能接入无线网的 NIC 才能保证连接到网络。笔记本电脑若没有内置 NIC，可通过 ExpressCard 或 CardBus、压缩闪存以及 USB 方式插一块 NIC 后再连网。

### 9.3 中继器（Repeater）

![中继器](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108135312124.png)

- **定义与作用**：中继器是在 OSI 模型的第 1 层 —— 物理层面上延长网络的设备。由电缆传来的电信号或光信号经中继器的波形调整和放大再传给另一个电缆，是对减弱的信号进行放大和发送的设备，通过物理层的连接延长网络。
- 特点：
  - **信号处理**：即使在数据链路层出现某些错误，中继器仍然转发数据；它只是单纯负责信号在 0 和 1 比特流之间的替换，并不负责判断数据是否有错误，且只负责将电信号转换为光信号，不能在传输速度不同的媒介之间转发。
  - **网络延长限制**：通过中继器进行的网络延长，其距离并非可以无限扩大。例如一个 10Mbps 的以太网最多可以用 4 个中继器分段连接，而一个 100Mbps 的以太网则最多只能连两个中继器。
  - **与集线器的关系**：有些中继器可以提供多个端口服务，这种中继器被称作中继集线器或集线器，集线器也可以看作是多口中继器，每个端口都可以成为一个中继器。

![中继器](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108135345973.png)

### 9.4 网桥（Bridge）/2层交换机

![网桥](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108140106126.png)

- **定义与位置**：网桥是在 OSI 模型的第 2 层 —— 数据链路层面上连接两个网络的设备。

- 工作原理：

  - **数据帧处理**：能够识别数据链路层中的数据帧，并将这些数据帧临时存储于内存，再重新生成信号作为一个全新的帧转发给相连的另一个网段。由于能存储数据帧，网桥能够连接 10BASE - T 与 100BASE - TX 等传输速率完全不同的数据链路，并且不限制连接网段的个数。
  - **数据校验与过滤**：数据链路的数据帧中有一个数据位叫做 FCS（帧校验序列），用以校验数据是否正确送达目的地。网桥通过检查这个域的值，将那些损坏的数据丢弃，从而避免发送给其他的网段。此外，网桥还能通过地址自学机制和过滤功能控制网络流量。这里所说的地址是指 MAC 地址、硬件地址、物理地址以及适配器地址，也就是网络上针对 NIC（网络接口卡）分配的具体地址。例如主机 A 与主机 B 之间进行通信时，只需对主机 A 发送数据帧即可，网桥会根据地址自学机制来判断是否需要转发数据帧。这类功能是OSI参考模型的第2层（数据链路层）所具有的功能。为此，有时也把网桥称作2层交换机(L2交换机)。
  - **自学式网桥**：有些网桥能够判断是否将数据报文转发给相邻的网段，这种网桥被称作自学式网桥。这类网桥会记住曾经通过自己转发的所有数据帧的 MAC 地址，并保存到自己里的内存表中。由此，可以判断哪个网段中包含有哪类 MAC 地址的设备。例如，主机 A 向主机 B 发送数据帧，网桥学习到主机 A 属于网络 A，暂时将数据帧转发给网络 B；当主机 B 向主机 A 发送数据帧时，由于网桥尚不知道主机 B 属于哪个网络，暂时将数据帧转发给网络 A；此后，当主机 A 再发送数据帧给主机 B 时，只在网络 A 中传送，因为网桥此时已经知道主机 A 属于网络 A，不再将应发往主机 A 的数据帧转发给网络 B，并且它也学习到主机 B 属于网络 A。

  ![自学式网桥](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108140151922.png)

  - 以太网等网络中经常使用的交换集线器,现在基本也属于网桥的一种。交换集线器中连接电缆的每个端口都能提供类似网桥的功能。

  ![交换集线器](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108140427853.png)

### 9.5 路由器/3层交换机

![路由器](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108140621273.png)

#### 一、路由器的基本功能与特点

- **连接网络**：路由器是连接网络与网络的设备，基本上可以连接任意两个数据链路，例如可以连接两个以太网，或者连接一个以太网与一个 FDDI（光纤分布式数据接口），现在人们在家或办公室里连接互联网所使用的宽带路由器也是路由器的一种。
- **报文转发**：它在 OSI 模型的第 3 层 —— 网络层面上连接两个网络，并对分组报文进行转发，能够将分组报文发送给另一个目标路由器地址，而网桥是根据物理地址（MAC 地址）进行处理，路由器则是根据 IP 地址进行处理，由此，TCP/IP 中网络层的地址就成为了 IP 地址。

#### 二、路由器的重要作用

- **分担网络负荷**：路由器具有分担网络负荷的作用，能够优化网络流量，提高网络的整体性能和效率，避免某个网络部分出现过载的情况。
- **网络安全功能**：有些路由器还具备一定的网络安全功能，例如可以进行访问控制、防火墙设置等，保护网络免受外部威胁和非法访问，在连接网络与网络的设备当中，路由器起着极为重要的作用。

### 9.6 4-7层交换机

![4-7层交换机](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108140809471.png)

#### 一、4 - 7 层交换机的功能与基础

- **功能范围**：4 - 7 层交换机负责处理 OSI 模型中从传输层至应用层的数据。若用 TCP/IP 分层模型表述，它是以 TCP 等协议的传输层及其上面的应用层为基础，分析收发数据，并对其进行特定的处理。

#### 二、4 - 7 层交换机的应用场景

- **负载均衡**：对于并发访问量非常大的企业级 Web 站点，一台服务器难以满足前端访问需求，通常会架设多台服务器来分担。这些服务器前端访问的入口地址通常只有一个（企业为方便使用者，只向最终用户开放一个统一的访问 URL），为通过同一个 URL 将前端访问分发到后台多个服务器上，可在这些服务器前端加一个负载均衡器，这种负载均衡器就是 4 - 7 层交换机的一种。
- **带宽控制**：在实际通信中，人们希望网络拥堵时优先处理像语音这类对及时性要求较高的通信请求，放缓像邮件或数据转发等稍有延迟也无大碍的通信请求，这种处理被称为带宽控制，是 4 - 7 层交换机的重要功能之一。
- **其他应用场景**：4 - 7 层交换机的应用场景还有很多，例如广域网加速器、特殊应用访问加速以及防火墙（可以防止互联网上的非法访问）等。

### 9.7 网关

![网关](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108141128836.png)

#### 网关的定义与功能

- **定义**：网关是 OSI 参考模型中负责将从传输层到应用层的数据进行转换和转发的设备。
- 功能：
  - **协议转换与数据转发**：它与 4 - 7 层交换机一样处理传输层及以上的数据，但网关不仅转发数据还负责对数据进行转换，通常使用表示层或应用层网关，在两个不能进行直接通信的协议之间进行翻译，最终实现两者之间的通信。
  - **应用网关示例**：例如互联网邮件与手机邮件之间的转换服务，因两者在表示层和应用层中的 “电子邮件协议” 互不相同，而网关能识别手机邮件与互联网邮件，并在它们的协议之间进行转换，从而使互联网的电脑与手机之间能够互发电子邮件。

#### 网关的应用场景

![邮件网关](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108141157333.png)

- **邮件网关**：如上述互联网邮件与手机邮件的转换，通过设置网关，实现不同协议邮件的互通。
- **代理服务器（应用网关）**：在使用 WWW（World Wide Web，万维网）时，为控制网络流量以及出于安全考虑，有时会使用代理服务器。这种代理服务器也是网关的一种，称为应用网关。有了代理服务器，客户端与服务器之间无需在网络层上直接通信，而是从传输层到应用层对数据和访问进行各种控制和处理。

![代理服务器](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108141230154.png)

### 9.8 总结

![各种设备及对应网络分层](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108141252498.png)

以下是根据图片内容及相关知识对这些网络设备的总结：
| 设备名称                             | OSI层次           | 含义                                             | 作用                                                         | 特点                                                         | 示例                                                         |
| ------------------------------------ | ----------------- | ------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 网卡（NIC）                          | 物理层/数据链路层 | 全称为网络接口卡，是计算机连接网络的必备硬件     | 使计算机能够接入网络，无论是以太网还是无线局域网             | 不同计算机接入网络的方式不同，如台式机可通过扩展槽外接，笔记本可通过多种方式外接或内置 | 无特定示例，是计算机网络连接的基础硬件                       |
| 中继器（Repeater）                   | 物理层            | 在物理层面上延长网络的设备                       | 对电缆传来的电信号或光信号进行波形调整和放大后再传给另一个电缆，以延长网络传输距离 | 只能对信号进行放大和发送，不负责判断数据错误，不能在传输速度不同的媒介间转发，网络延长距离有限制 | 一个10Mbps的以太网最多可用4个中继器分段连接，100Mbps的以太网最多连两个中继器 |
| 网桥/2层交换机（Bridge/L2 Switch）   | 数据链路层        | 在数据链路层面上连接两个网络的设备               | 识别数据链路层中的数据帧，临时存储并重新生成信号转发给另一个网段，可根据数据帧内容和地址自学机制控制网络流量、丢弃损坏数据帧 | 能连接不同传输速率的数据链路且不限制网段个数，通过地址学习判断是否转发数据帧，交换集线器属于网桥的一种，交换机每个端口有类似网桥功能 | 自学式网桥会记住转发数据帧的MAC地址，判断网段中设备的MAC地址归属，如主机A与主机B通信时网桥的转发学习过程 |
| 路由器/3层交换机（Router/L3 Switch） | 网络层            | 连接网络与网络的设备                             | 根据IP地址对分组报文进行转发，连接不同的数据链路，分担网络负荷，部分具备网络安全功能 | 基于IP地址处理，可连接多种网络，在网络连接和负荷分担等方面起重要作用，宽带路由器是常见类型 | 连接以太网与FDDI网络，家庭或办公室用于连接互联网的宽带路由器 |
| 4 - 7层交换机                        | 传输层至应用层    | 负责处理OSI模型中从传输层至应用层数据的设备      | 以TCP等协议的传输层及其上面的应用层为基础，分析收发数据并进行特定处理，如负载均衡、带宽控制等，还有广域网加速器、特殊应用访问加速及防火墙等应用场景 | 可根据高层协议处理数据，实现多种高级功能，满足不同网络需求，提升网络性能和服务质量 | 企业级Web站点为应对大并发访问量，在服务器前端加负载均衡器（4 - 7层交换机的一种） |
| 网关（Gateway）                      | 传输层至应用层    | 负责将从传输层到应用层的数据进行转换和转发的设备 | 在不能直接通信的协议之间进行翻译，实现两者之间的通信，如邮件网关可实现不同邮件协议的转换，代理服务器（应用网关）可控制网络流量和进行安全处理 | 不仅转发数据还负责协议转换，使用表示层或应用层网关，在多种场景下实现不同系统或网络间的通信 | 互联网邮件与手机邮件之间设置网关实现互通，WWW中使用代理服务器（应用网关）控制流量和安全 |

这些网络设备在网络架构中各司其职，共同保障网络的正常运行和高效通信。

### 9.9 邮件发送示例

结合主机 A 发邮件到主机 B 的实例，说明各个设备在其中的作用：

#### 网卡（NIC）

- **作用**：主机 A 和主机 B 都需要网卡来接入网络。网卡将主机内部的数据转换为可以在网络介质（如网线、无线网络）上传输的信号，同时也将接收到的网络信号转换为主机可识别的数据。
- **实例**：当主机 A 要发送邮件时，邮件数据首先通过网卡转换为电信号或光信号，然后通过网线或无线网络发送出去；主机 B 的网卡则负责接收这些信号，并将其转换回数据，传递给主机 B 的操作系统和邮件客户端。

#### 中继器（Repeater）

- **作用**：如果主机 A 和主机 B 之间的网络距离较远，信号在传输过程中可能会衰减。中继器可以接收衰减的信号，将其放大和整形后再继续传输，从而延长网络的传输距离，确保邮件数据能够完整地传输到目的地。
- **实例**：假设主机 A 在一个较大的办公楼的一端，主机 B 在另一端，中间的网络线缆较长，信号可能变弱。在网络线缆中间放置中继器，它会增强邮件数据信号，使得主机 B 能够准确接收到邮件。

#### 网桥 / 2 层交换机（Bridge/L2 Switch）

- **作用**：网桥或 2 层交换机可以连接多个网络段，根据数据帧中的 MAC 地址来转发邮件数据。它们可以隔离网络冲突域，提高网络的带宽利用率和性能。例如，如果主机 A 和主机 B 处于不同的网络段，网桥或 2 层交换机可以根据邮件数据帧中的目的 MAC 地址，将数据准确地转发到主机 B 所在的网络段。
- **实例**：在一个公司网络中，主机 A 在销售部门的网络段，主机 B 在技术部门的网络段，两个网络段通过网桥或 2 层交换机连接。当主机 A 发送邮件时，网桥或 2 层交换机检查邮件数据帧的目的 MAC 地址，发现是主机 B 的 MAC 地址，然后将数据帧转发到技术部门的网络段，最终到达主机 B。

#### 路由器 / 3 层交换机（Router/L3 Switch）

- **作用**：路由器或 3 层交换机工作在网络层，根据 IP 地址来路由邮件数据。它们可以连接不同的网络，如局域网和广域网，实现不同网络之间的通信。当主机 A 和主机 B 处于不同的网络（如不同的公司网络或不同的城市网络）时，路由器根据邮件数据的目的 IP 地址，选择最佳的路径将数据转发到主机 B 所在的网络。
- **实例**：主机 A 在公司 A 的网络中，主机 B 在公司 B 的网络中，两个公司网络通过互联网连接。主机 A 发送邮件时，邮件数据首先到达公司 A 的路由器，路由器根据目的 IP 地址查找路由表，确定将数据发送到互联网上的下一个路由器，经过多个路由器的转发，最终到达公司 B 的网络，再由公司 B 的路由器将数据转发到主机 B。

#### 4 - 7 层交换机

- **作用**：4 - 7 层交换机可以根据邮件应用层的协议（如 SMTP、POP3 等）和其他高层信息（如 URL、端口号等）来处理邮件数据。它可以实现负载均衡，例如当多个邮件服务器处理邮件时，4 - 7 层交换机可以将邮件请求均匀地分配到不同的服务器上，提高邮件系统的处理能力和可靠性。此外，它还可以进行带宽控制，确保重要的邮件业务（如紧急邮件）能够优先处理。
- **实例**：一个大型邮件服务提供商有多个邮件服务器来处理用户的邮件。当主机 A 发送邮件时，4 - 7 层交换机根据当前各邮件服务器的负载情况，将邮件请求分配到负载较轻的服务器上进行处理。如果网络带宽紧张，4 - 7 层交换机可以优先保证邮件数据的传输，而对一些非关键的网络流量进行限制。

#### 网关（Gateway）

- **作用**：如果主机 A 和主机 B 使用不同的邮件协议或处于不同的网络环境（如一个是企业内部网络，一个是互联网），网关可以进行协议转换和数据转发。例如，将企业内部的邮件协议转换为互联网通用的邮件协议，或者在不同安全域之间进行数据的安全转换和传输。
- **实例**：主机 A 在一个使用专有邮件系统的企业内部网络中，主机 B 在互联网上使用标准的 SMTP/POP3 邮件协议。当主机 A 发送邮件到主机 B 时，企业网络的网关将企业内部的邮件格式和协议转换为互联网标准的邮件格式和协议（如将企业内部的邮件地址转换为互联网域名地址，将企业内部的邮件传输协议转换为 SMTP 等），然后通过互联网将邮件发送到主机 B。



## 10.现代网络实态

#### 10.1 网络的构成

- **类比交通道路**：以交通道路为例，大型城市道路交通网中有高速公路，计算机网络中类似的部分称为 “骨干” 或 “核心”，是网络中心，通常用高速路由器相互连接以快速传输大量数据；网络中对应高速公路出入口的部分是 “边缘网络”，常用设备有多功能路由器和 3 层交换机；连接 “边缘网络” 的部分叫 “接入层” 或 “汇聚层”，骨干网可专注于提高业务传输性能和网络生存性，将高速路由器和交换机移到网络边缘，边缘网络常用 2 层交换机或 3 层交换机。

  ![核心骨干网络](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108143022062.png)

#### 10.2 互联网通信

![互联网通信](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108143044993.png)

- **家庭或公司联网**：人们在家或公司连接互联网时，一般使用互联网接入服务，联网后汇集到无线局域网路由器和最近交换机的通信会再次被连接到 “接入层”，甚至可能通过 “边缘网络” 或 “主干网” 实现与目标地址的通信。

#### 10.3 移动通信

![移动通信](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108143133244.png)

- **手机通信过程**：手机开机后自动与最近基站无线通信，基站相当于网络的 “接入层”，手机终端发送信号给另一终端时，请求会传送到注册对端手机号码的基站，对方接听就建立通信连接，基站收集的通信请求汇集到控制中心（“边缘网络”），再接入到互连通信控制中心的主干网，手机网络构成与互联网接入服务相似，包括声音主干网和数据主干网等。

#### 四、从信息发布者的角度看网络

![信息发布](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20250108143213070.png)

- **信息发布方式变化**：以往个人和企业多自己制作网站部署到服务器发布信息，现在通过博客、托管主机服务的案例增多，优点是无需做服务器和网络运维管理，只需关注特定网站，托管主机服务常有即时传播机制，以动画发布网站为例，面对高并发访问量，托管主机会集合多个存储通过高速网络提高响应速度，这种方式叫数据中心，数据中心由大型服务器、存储及计算机网络构成，大型数据中心可能直接连接 “主干网”，小规模数据中心多连接 “边缘网络”，数据中心内部网络分布着 3 层交换机和高速路由器，也有人研究高性能 2 层交换机的使用。

## 11. 其他知识点

### 11.1 CPU与OS
- CPU是中央处理器，如同计算机的“心脏”，决定计算机处理性能，常用产品有Intel Core、Intel Atom、ARM Cortex等。
- OS是操作系统，是基础软件，集合CPU管理、内存管理、外设管理和程序运行管理等功能，个人电脑常用的有UNIX、Windows、Mac OS X、Linux等。
- 计算机可运行指令因CPU和OS不同而异，数据存储也受其影响，不同CPU和OS的计算机通信需支持的协议并按协议读取数据。
- CPU同一时间通常只能运行一个程序，操作系统采用CPU时间片轮转机制实现多任务调度。

### 11.2 标准化
- 标准化是使不同厂商异构产品具兼容性和易用性的规范化过程，除计算机通信领域外，日常用品也需标准化。
- 标准化组织分为国际级、国家级和民间团体三类，国际级有ISO、ITU - T等，国家级如日本JISC和美国ANSI，民间团体有IETF等。
- 现实世界里很多优秀技术因未公开开发规范未普及，企业公开规范成行业标准可促进行业发展，标准化对世界有重要影响。

### 11.3 OSI协议与OSI参考模型
- OSI参考模型将通信功能划分为7个分层，OSI协议以其为基础界定各阶层协议和接口标准，遵循OSI协议的产品叫OSI产品，通信叫OSI通信。
- 本书通过对比OSI参考模型与TCP/IP协议功能来深入讲解，虽TCP/IP分层模型与OSI有区别，但OSI参考模型有助于理解TCP/IP。

### 11.4 面向有连接与面向无连接
- “连接”在人类社会相当于“人脉”，面向无连接就是没有关系的意思，如高尔夫比赛中“要到哪儿去得问球”是面向无连接通信的发送端处理方式。
- 面向无连接虽看似不靠谱，但对某些特殊设备是高效方法，可省略繁杂手续，利于制作低成本产品和减轻处理负担，可根据通信内容决定采用哪种方式。

### 11.5 传输速率与吞吐量
- 传输速率是数据传输中两设备间数据流动的物理速度，单位bps，传输速率高指单位时间传输的数据量多，低速数据链路如同车道少的道路，高速数据链路像多车道道路，传输速率又称带宽，带宽越大网络传输能力越强。
- 吞吐量是主机之间实际的传输速率，单位bps，它衡量带宽，也衡量主机CPU处理能力、网络拥堵程度、报文中数据字段占有份额等信息。

### 11.6 网络设备之间的连接
- 网络设备连接需遵循规范和标准，否则无法连接或易出故障，制定规范是长期过程，新技术诞生初期兼容性问题突出，虽随时间推移有所改善，但仍无法达100%兼容。
- 实际搭建网络时，不仅要关注产品规格参数和兼容性，更应重视长期使用中的性能指标，未充分调查就使用新产品后果不堪设想。

### 11.7 LTE与语音呼叫
- 第3代和3.5代移动通信网络初用于传输最高64kbps语音呼叫和少量数据通信，LTE是3G向4G演变的过渡型技术，是3GPP制定的移动通信规范，不同情况最大可实现下行300Mbps、上行75Mbps无线通信。
- LTE标准中声音当作IP数据包传输，需在整个网络上应用TCP/IP协议，可采用CSFB技术让语音呼叫部分仅在手机通信网络中传输，保证通话语音高品质，目前因通信服务多样和手机终端高速高性能化，人们研发更多类似LTE的技术改善网络环境。

### 11.8 公共无线局域网对手机终端的认证
- 家庭或公司无线局域网线路连接固定，使用者限于特定人群，公共无线局域网因运营商不同，需对使用者验证合法性，确保合法用户才能连接，使用手机等移动通信终端时要先确认签约运营商，让提供商从终端获取信息识别用户，公共无线局域网一般无其他特殊认证要求。