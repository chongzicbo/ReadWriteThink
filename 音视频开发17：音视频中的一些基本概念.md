---
title: '音视频开发17：音视频开发中的一些基本概念'
categories:
  - [开发,音视频,基础]
tags:
  - 音视频开发
  - 音视频基础
date: 2024-12-26 15:37:00
---

# 音视频开发中的一些基本概念

## 码流

**码流（Bitstream）** 是指经过编码后的音视频数据在传输或存储时的二进制数据流。它是将原始的音视频信号经过压缩编码后，按照一定的格式组织成连续的二进制数据序列。码流是音视频编码的最终输出形式，通常用于存储在文件中（如 MP4、AVI、MKV 等格式）或通过网络传输（如 RTMP、HLS、DASH 等协议）。

---

### 码流的组成
码流由多个编码单元组成，这些单元可以是视频帧、音频帧或其他辅助信息。具体来说，码流通常包含以下几部分：

1. **视频数据**：
   - 视频帧（如 I 帧、P 帧、B 帧）经过编码后生成的二进制数据。
   - 视频帧可以进一步划分为切片（Slice）或宏块（Macroblock），这些切片或宏块会被封装成 NALU（在 H.264/H.265 中）。

2. **音频数据**：
   - 音频采样数据经过编码后生成的二进制数据。
   - 音频数据通常以帧为单位，每个音频帧包含一定数量的采样点。

3. **辅助信息**：
   - 参数集（如 SPS、PPS）：包含视频编码的全局参数（如分辨率、帧率、量化参数等）。
   - SEI（Supplemental Enhancement Information）：包含一些辅助信息，如时间戳、版权信息等。
   - 其他元数据：如文件头信息、编码器版本等。

---

### 码流的格式
码流的格式取决于具体的编码标准和封装格式。以下是一些常见的码流格式：

1. **H.264/AVC 码流**：
   - 由多个 NALU（Network Abstraction Layer Unit）组成。
   - 每个 NALU 包含一个 NAL Header 和 NAL Payload。
   - NALU 的类型决定了其内容（如 I 帧、P 帧、SPS、PPS 等）。

2. **H.265/HEVC 码流**：
   - 类似于 H.264，但 NALU 的结构和类型有所扩展。
   - 支持更高的压缩效率和更高的分辨率。

3. **AAC 音频码流**：
   - 由多个音频帧组成，每个音频帧包含一定数量的采样点。
   - 音频帧的头部包含一些控制信息（如采样率、声道数等）。

4. **MP4 文件中的码流**：
   - MP4 是一种封装格式，内部包含视频和音频的码流。
   - 视频和音频的码流分别存储在不同的轨道（Track）中。

---

### 码流的作用
1. **压缩与存储**：
   - 原始音视频数据通常体积庞大，通过编码生成码流可以显著减小数据量，便于存储和传输。

2. **传输与分发**：
   - 码流可以通过网络传输，支持实时流媒体（如直播、点播）。
   - 常见的传输协议包括 RTMP、HLS、DASH 等。

3. **解码与播放**：
   - 解码器（如播放器）从码流中提取数据，并根据编码标准进行解码，还原出原始的音视频信号。

---

### 码流的特性
1. **可变码率（VBR）与固定码率（CBR）**：
   - **VBR（Variable Bit Rate）**：码率随内容复杂度变化，适合高质量编码。
   - **CBR（Constant Bit Rate）**：码率保持恒定，适合实时传输。

2. **帧间依赖性**：
   - 视频码流中的帧通常是相互依赖的，例如 P 帧依赖于 I 帧或 P 帧。
   - 这种依赖性使得码流在传输过程中需要保证帧的顺序和完整性。

3. **容错性**：
   - 码流中通常包含一些冗余信息或校验机制，以提高在网络传输中的容错能力。

---

### 总结
**码流** 是音视频编码后的二进制数据流，用于存储或传输。它由视频数据、音频数据和辅助信息组成，常见的格式包括 H.264/H.265 码流、AAC 音频码流等。码流的设计目的是在保证音视频质量的前提下，尽可能减小数据量，便于存储和传输。

## NALU

在音视频编码中，NALU（Network Abstraction Layer Unit）是H.264/AVC和H.265/HEVC等视频编码标准中的一个重要概念。NALU 是视频编码数据的基本单元，用于将编码后的视频数据封装成适合网络传输的格式。

### NALU 的结构
一个 NALU 通常由以下两部分组成：
1. **NAL Header（NAL 头部）**：
   - 包含一些控制信息，如 NALU 类型、重要性标志等。
   - 在 H.264 中，NAL Header 通常是 1 字节，格式如下：
     - `forbidden_zero_bit`（1 bit）：禁止位，通常为 0。
     - `nal_ref_idc`（2 bits）：NAL 单元的重要性标志，表示该 NALU 是否用于参考帧重建。
     - `nal_unit_type`（5 bits）：NAL 单元的类型，指示该 NALU 的具体用途（如 IDR 帧、P 帧、SPS、PPS 等）。

2. **NAL Payload（NAL 负载）**：
   - 包含实际的编码数据，可能是视频帧的切片数据、参数集（如 SPS、PPS）或其他辅助信息。
   - NAL Payload 中的数据是经过熵编码（如 CABAC 或 CAVLC）后的压缩数据。

### NALU 的类型
NALU 的类型由 `nal_unit_type` 字段决定，常见的类型包括：
- **IDR 帧（Instantaneous Decoding Refresh）**：
  - 类型 5，表示一个关键帧，解码器可以从中开始解码。
- **P 帧（Predictive Frame）**：
  - 类型 1，表示一个预测帧，依赖于之前的帧进行解码。
- **SPS（Sequence Parameter Set）**：
  - 类型 7，包含视频序列的全局参数（如分辨率、帧率等）。
- **PPS（Picture Parameter Set）**：
  - 类型 8，包含图像级别的参数（如量化参数、参考帧配置等）。
- **SEI（Supplemental Enhancement Information）**：
  - 类型 6，包含一些辅助信息，如时间戳、版权信息等。

### NALU 的作用
1. **网络传输的适配**：
   - NALU 的设计目的是将视频编码数据封装成适合网络传输的格式，便于在不同网络环境下传输。
   - NALU 可以独立传输，解码器可以根据 NALU 的类型和内容进行解码。

2. **分层结构**：
   - NALU 将视频数据分为不同的层次（如序列层、图像层、切片层等），便于管理和解码。

3. **错误恢复**：
   - NALU 中的 `nal_ref_idc` 字段可以指示该 NALU 的重要性，帮助网络传输层在丢包时优先保留重要数据。

### 哪些音视频编码包含NALU

#### 1. **H.264/AVC（Advanced Video Coding）**
   - **NALU 的核心应用**：
     - H.264 是第一个广泛使用 NALU 的编码标准。
     - NALU 是 H.264 码流的基本组成单元，用于封装视频编码数据。
   - **NALU 的类型**：
     - **IDR 帧**（类型 5）：关键帧，解码器可以从中开始解码。
     - **P 帧**（类型 1）：预测帧，依赖于之前的帧。
     - **SPS（Sequence Parameter Set）**（类型 7）：包含视频序列的全局参数。
     - **PPS（Picture Parameter Set）**（类型 8）：包含图像级别的参数。
     - **SEI（Supplemental Enhancement Information）**（类型 6）：辅助信息，如时间戳、版权信息等。
   - **作用**：
     - 将编码数据封装为适合网络传输的格式。
     - 支持分层结构，便于管理和解码。

---

#### 2. **H.265/HEVC（High Efficiency Video Coding）**
   - **NALU 的扩展应用**：
     - H.265 是 H.264 的继任者，支持更高的压缩效率和更高的分辨率。
     - NALU 的结构在 H.265 中得到了扩展，支持更多的类型和功能。
   - **NALU 的类型**：
     - **IDR 帧**（类型 19）：关键帧。
     - **P 帧**（类型 1）：预测帧。
     - **SPS（Sequence Parameter Set）**（类型 33）：包含视频序列的全局参数。
     - **PPS（Picture Parameter Set）**（类型 34）：包含图像级别的参数。
     - **SEI（Supplemental Enhancement Information）**（类型 39）：辅助信息。
   - **作用**：
     - 支持更高的分辨率和更复杂的编码结构。
     - 优化了网络传输的适应性。

---

#### 3. **AV1（AOMedia Video 1）**
   - **NALU 的类似概念**：
     - AV1 是一种开源的、免专利费的视频编码标准，由 AOMedia 开发。
     - AV1 的码流结构与 NALU 类似，但采用了不同的封装方式。
   - **AV1 的封装单元**：
     - AV1 使用 **OBU（Open Bitstream Unit）** 作为基本封装单元，类似于 NALU。
     - OBU 包含头部和负载，用于封装编码数据。
   - **作用**：
     - 支持高效的压缩和灵活的网络传输。

---

#### 4. **VP9（Video Codec 9）**
   - **NALU 的类似概念**：
     - VP9 是由 Google 开发的免费视频编码标准，主要用于 WebRTC 和 Web 视频。
     - VP9 的码流结构与 NALU 类似，但采用了不同的封装方式。
   - **VP9 的封装单元**：
     - VP9 使用 **Frame-based 结构**，每个帧被封装为一个独立的单元。
     - 类似于 NALU，但 VP9 的封装更简单。
   - **作用**：
     - 支持高效的压缩和实时传输。

---

#### 5. **其他相关标准**
   - **H.266/VVC（Versatile Video Coding）**：
     - H.266 是 H.265 的继任者，进一步提升了压缩效率。
     - NALU 的概念在 H.266 中得到了延续和扩展。
   - **MPEG-2**：
     - MPEG-2 是最早的数字视频编码标准之一，虽然它没有明确的 NALU 概念，但其码流结构与 NALU 类似。

---

#### 总结
**NALU** 是现代音视频编码标准中的核心概念，主要存在于以下编码格式中：
- **H.264/AVC**：NALU 的核心应用。
- **H.265/HEVC**：NALU 的扩展应用。
- **AV1**：采用类似 NALU 的 OBU 结构。
- **VP9**：采用类似 NALU 的帧封装结构。
- **H.266/VVC**：NALU 的延续和扩展。

NALU 的设计目的是将编码数据封装为适合网络传输的格式，支持高效的解码和灵活的网络适应性。

### 总结
NALU 是 H.264/AVC 和 H.265/HEVC 视频编码中的基本数据单元，用于封装编码后的视频数据。它由 NAL Header 和 NAL Payload 组成，NAL Header 包含控制信息，NAL Payload 包含实际的编码数据。NALU 的设计使得视频数据可以灵活地适应不同的网络传输环境，并且支持高效的解码和错误恢复。

文章合集：[chongzicbo/ReadWriteThink: 博学而笃志，切问而近思 (github.com)](https://github.com/chongzicbo/ReadWriteThink/tree/main)

个人博客：[程博仕](https://chongzicbo.github.io/)

微信公众号：

![微信公众号](https://raw.githubusercontent.com/chongzicbo/images/main/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg)

